version: "3"
services:
    database:
        image: mongo:4.2.3
        container_name: wenet_task_manager_database
        restart: always
        ports:
            - "27017:27017"
        environment:
            MONGO_INITDB_ROOT_USERNAME: ${MONGO_ROOT_USER:-root}
            MONGO_INITDB_ROOT_PASSWORD: ${MONGO_ROOT_PASSWORD:-password}
            MONGO_INITDB_DATABASE: wenetTaskManagerDB
        volumes:
            - ./init-mongo.js:/docker-entrypoint-initdb.d/init-mongo.js
            - wenet_task_manager_data:/data/db
    api:
        build:
            context: ../../../.
            dockerfile: src/main/docker/Dockerfile
        image: "wenet/task-manager"
        container_name: wenet_task_manager_api
        depends_on:
            - database
        ports:
            - ${API_PORT:-80}:8080
        environment:
            DB_HOST: database
            WAIT_HOSTS: database:27017
volumes:
    wenet_task_manager_data:
